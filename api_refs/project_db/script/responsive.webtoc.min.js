isPostMessageEnabled()&&addMessageListener(tocMessageHandler);
function tocMessageHandler(a){switch(getMessage(a.data).messageType){case "getNextTopic":a=moveToNextNode(!0);a.length&&a.attr("href").substring(0,1)!="#"&&(_ignoreSyncRequest=!1,syncToCNodeImplementation(a),_ignoreSyncRequest=!0,window.parent.parent.postMessage("navigate|"+a.attr("href"),"*"));break;case "getPreviousTopic":a=moveToPreviousNode(!0),a.length&&a.attr("href").substring(0,1)!="#"&&(_ignoreSyncRequest=!1,syncToCNodeImplementation(a),_ignoreSyncRequest=!0,window.parent.parent.postMessage("navigate|"+
a.attr("href"),"*"))}}function syncToCNodeImplementation(a){a=a.parent().closest("ul");buildToCPage(a.attr("id"))}window.syncToCNodeImplementation=syncToCNodeImplementation;
function buildToCPage(a){a=="root"&&(a="Node-root");if($.mobile.activePage.length&&$.mobile.activePage.attr("id")==a)_highlightSelectedNode();else if($("div#"+a).length)$.mobile.changePage($("div#"+a),{dataUrl:a});else{var b=$("ul#"+a).first(),c=b.prev("a").text(),d=b.parent().closest("ul").attr("id"),e=$('<div data-role="page" id="'+a+'"></div>'),f=$('<div data-role="header" data-theme="b"></div>');d=="root"&&(d="Node-root");$('<a href="#'+d+'" data-icon="arrow-l" data-iconpos="notext">Back</a>').appendTo(f);
$("<h1>"+c+"</h1>").appendTo(f);f.appendTo(e);b=b.clone();b.find("ul").remove();b.css("display","");b.attr("data-role","listview");b.removeAttr("id");b.find("a:not(a[href*=#Node-])").closest("li").attr("data-icon","false");b.appendTo(e);e.appendTo("div#container");e.page();$.mobile.changePage(e,{dataUrl:a})}}
function constructMobileToC(){var a=0;$("li>a").each(function(){var b=$(this).next("ul");if(b.length){if($(this).attr("href")!="#"){var c=$("<li></li>").prepend($(this).clone());b.prepend(c)}b.attr("id","Node-"+a);$(this).attr("href","#Node-"+a);a++}});var b=0;$("ul.root a").each(function(){$(this).attr("data-node-index",b);b++});var c=$('<div data-role="page" id="Node-root"></div>'),d=$("ul#root").clone().removeAttr("id").removeAttr("style").attr("data-role","listview");d.find("ul").remove();d.find("a:not(a[href*=#Node-])").closest("li").attr("data-icon",
"false");d.appendTo(c);c.appendTo("div#container");$.mobile.initializePage()}window.constructMobileToC=constructMobileToC;function _highlightSelectedNode(){$("div.ui-page li.ui-btn-active").removeClass("ui-btn-active");$("div.ui-page li").find('a[data-node-index="'+_selectedNodeIndex+'"]').first().closest("li").addClass("ui-btn-active")}
$(document).bind("pagebeforechange",function(a,b){if(typeof b.toPage==="string")if(b.toPage.match(/#Node-(\d|root)/)){var c=b.toPage.substring(b.toPage.lastIndexOf("#")+1,b.toPage.length);$("div#"+c).length==0&&(buildToCPage(c),a.preventDefault())}else a.preventDefault()});$(document).bind("pagechange",function(a,b){typeof b.options.fromPage!="undefined"&&b.options.fromPage.attr("id")!="Node-root"&&b.toPage.attr("id")!=b.options.fromPage.attr("id")&&b.options.fromPage.remove();_highlightSelectedNode()});
$(document).on("vclick","a",function(a){var b=$(this);if(b.attr("href").substring(0,1)!="#")a.preventDefault(),_highlightSelectedNode(b),setSelectedNode(b),_ignoreSyncRequest=!0,a=window.parent.parent,typeof a!="undefined"&&a.postMessage("navigate|"+b.attr("href"),"*")});
